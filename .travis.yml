dist: trusty
before_script:
  - sudo apt install qemu-kvm libvirt-bin
  - sudo gpasswd -a $(whoami) libvirtd
  - newgrp libvirtd
  - sudo curl -L https://github.com/dhiltgen/docker-machine-kvm/releases/download/v0.8.2/docker-machine-driver-kvm -o /usr/bin/docker-machine-driver-kvm
  - sudo chmod +x /usr/bin/docker-machine-driver-kvm
  - wget https://github.com/minishift/minishift/releases/download/v1.0.0-rc.1/minishift-1.0.0-rc.1-linux-amd64.tgz
  - tar xvzOf minishift-1.0.0-rc.1-linux-amd64.tgz > minishift.bin
  - sudo mv minishift.bin /usr/bin/minishift
  - sudo mount --make-shared /
  - sudo service docker stop
  - sudo sed -i 's/DOCKER_OPTS=\"/DOCKER_OPTS=\"--insecure-registry 172.30.0.0\/16 /' /etc/default/docker
  - sudo service docker start
  - pip install docker-squash
  - wget https://github.com/openshift/source-to-image/releases/download/v1.1.5/source-to-image-v1.1.5-4dd7721-linux-amd64.tar.gz
  - tar xvzOf source-to-image-v1.1.5-4dd7721-linux-amd64.tar.gz > s2i.bin
  - sudo mv s2i.bin /usr/bin/s2i
  - sudo chmod 755 /usr/bin/s2i
  - wget https://github.com/openshift/origin/releases/download/v3.6.0-alpha.0/openshift-origin-client-tools-v3.6.0-alpha.0-0343989-linux-64bit.tar.gz
  - tar xvzOf openshift-origin-client-tools-v3.6.0-alpha.0-0343989-linux-64bit.tar.gz > oc.bin
  - sudo mv oc.bin /usr/bin/oc
  - sudo chmod 755 /usr/bin/oc
script:
  - make test TARGET=centos7
  - make test TARGET=atomic
  - make test TARGET=fedora
  - make test TARGET=rhel7
  - make onbuild TARGET=centos7 VERSIONS=7.8.0
  - make onbuild TARGET=atomic VERSIONS=7.8.0
  - make onbuild TARGET=fedora VERSIONS=7.8.0
  - make onbuild TARGET=rhel7 VERSIONS=7.8.0
  - test/onbuild-test
notifications:
  irc: "chat.freenode.net#brass-monkey"